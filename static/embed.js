(function(){"use strict";const g="http://localhost:3000";function b(){if(document.getElementById("dental-chatbot-widget-container")){console.warn("Dental Chatbot Widget is already initialized");return}D(),M(),O()}function D(){const a=document.createElement("style");a.id="dental-chatbot-widget-styles",a.textContent=`
    /* INJECT_COMPILED_CSS */
  `,document.head.appendChild(a)}function M(){const a=document.createElement("div");a.id="dental-chatbot-widget-container",a.innerHTML=`
    <!-- INJECT_COMPILED_HTML -->
  `,document.body.appendChild(a)}function O(){let a=!0,m=localStorage.getItem("chatbot-user-id")||c(),i=[],u=!1;const p=window.location.hostname||"unknown",s=document.getElementById("dental-chatbot-widget-container"),w=document.querySelector("#dental-chatbot-widget-container .dental-chatbot-header"),o=document.querySelector("#dental-chatbot-widget-container .dental-chatbot-messages"),d=document.querySelector("#dental-chatbot-widget-container .dental-chatbot-input"),S=document.querySelector("#dental-chatbot-widget-container .dental-chatbot-send");m=localStorage.getItem("chatbot-user-id")||c(),localStorage.setItem("chatbot-user-id",m);const I=localStorage.getItem("chatbot-minimized");I!==null&&(a=JSON.parse(I),a||x()),N(),w&&w.addEventListener("click",T),d&&d.addEventListener("keydown",t=>{t.key==="Enter"&&E()}),S&&S.addEventListener("click",E),window.ChatbotWidget={open:x,close:L,toggle:T,isOpen:()=>!a};function c(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function N(){const t=localStorage.getItem("chatbot-messages");if(t)try{i=JSON.parse(t).map(n=>({...n,timestamp:new Date(n.timestamp)})),l()}catch(e){console.error("Failed to parse saved messages:",e),i=[],C()}else C()}function h(){localStorage.setItem("chatbot-messages",JSON.stringify(i))}function l(){o&&(o.innerHTML="",i.forEach(t=>{const e=document.createElement("div");e.className=`dental-chatbot-message ${t.sender==="user"?"dental-chatbot-message-user":"dental-chatbot-message-bot"}`;const n=document.createElement("div");n.textContent=t.text;const r=document.createElement("div");r.className="dental-chatbot-timestamp",r.textContent=z(t.timestamp),e.appendChild(n),e.appendChild(r),o.appendChild(e)}),f())}function z(t){return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function f(){o&&(o.scrollTop=o.scrollHeight)}async function E(){if(!d||!d.value.trim()||u)return;const t=d.value.trim();d.value="",u=!0;const e=c();i.push({id:e,sender:"user",text:t,timestamp:new Date}),l(),h(),v();try{const n=await fetch(`${g}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:m,message:t,domain:p})});if(!n.ok)throw new Error(`API responded with status ${n.status}`);const r=await n.json();y(),i.push({id:r.id||c(),sender:"bot",text:r.text,timestamp:r.timestamp?new Date(r.timestamp):new Date}),l(),h()}catch(n){console.error("Error sending message:",n),y(),i.push({id:c(),sender:"bot",text:"Sorry, I encountered an error. Please try again later.",timestamp:new Date}),l(),h()}finally{u=!1}}function v(){if(!o)return;const t=document.createElement("div");t.className="dental-chatbot-typing",t.id="dental-chatbot-typing";for(let e=0;e<3;e++){const n=document.createElement("div");n.className="dental-chatbot-typing-dot",t.appendChild(n)}o.appendChild(t),f()}function y(){const t=document.getElementById("dental-chatbot-typing");t&&t.remove()}async function C(){if(!(i.length>0)){u=!0,v();try{const t=await fetch(`${g}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:m,message:"hello",domain:p})});if(t.ok){const e=await t.json();i.push({id:e.id||c(),sender:"bot",text:e.text,timestamp:e.timestamp?new Date(e.timestamp):new Date})}else throw new Error(`API responded with status ${t.status}`)}catch(t){console.error("Error getting initial greeting:",t),i.push({id:c(),sender:"bot",text:`Hello! How can I help you today? You're visiting from ${p}.`,timestamp:new Date})}finally{y(),u=!1,l(),h()}}}function x(){if(!s)return;a=!1,s.classList.remove("dental-chatbot-minimized"),s.classList.add("dental-chatbot-expanded"),o&&(o.style.display="block");const t=s.querySelector(".dental-chatbot-input-container");t&&(t.style.display="flex"),localStorage.setItem("chatbot-minimized","false"),f()}function L(){if(!s)return;a=!0,s.classList.remove("dental-chatbot-expanded"),s.classList.add("dental-chatbot-minimized"),o&&(o.style.display="none");const t=s.querySelector(".dental-chatbot-input-container");t&&(t.style.display="none"),localStorage.setItem("chatbot-minimized","true")}function T(){a?x():L()}async function k(){try{const t=await fetch(`${g}/history/${m}`);if(t.ok){const e=await t.json();if(e.messages&&e.messages.length>0)return i=e.messages.map(n=>({...n,timestamp:new Date(n.timestamp)})),l(),h(),!0}return!1}catch(t){return console.error("Error fetching chat history:",t),!1}}k()}document.readyState==="complete"||document.readyState==="interactive"?setTimeout(b,1):document.addEventListener("DOMContentLoaded",b)})();
//# sourceMappingURL=embed.js.map
