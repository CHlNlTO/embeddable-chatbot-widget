{"version":3,"file":"embed.js","sources":["../src/lib/embed.ts"],"sourcesContent":["/**\r\n * Dental Chatbot Widget - Embeddable Script\r\n *\r\n * This script creates an iframe that loads the chatbot widget and\r\n * provides an API for controlling the widget.\r\n */\r\n\r\n// Define the global window interface\r\ndeclare global {\r\n\tinterface Window {\r\n\t\tChatbotWidget?: ChatbotWidgetAPI;\r\n\t}\r\n}\r\n\r\n// Constants\r\nconst WIDGET_ID = 'dental-chatbot-widget-iframe';\r\nconst DEFAULT_WIDTH = '320px';\r\nconst DEFAULT_HEIGHT = '450px';\r\nconst MINIMIZED_HEIGHT = '48px';\r\n\r\n// Define the ChatbotWidget API Interface\r\ninterface ChatbotWidgetAPI {\r\n\topen: () => void;\r\n\tclose: () => void;\r\n\ttoggle: () => void;\r\n\tsetTheme?: (theme: 'light' | 'dark') => void;\r\n\tisOpen: () => boolean;\r\n}\r\n\r\n/**\r\n * Create and initialize the widget iframe\r\n */\r\nfunction initializeChatbotWidget(): HTMLIFrameElement | null {\r\n\ttry {\r\n\t\t// Prevent duplicates\r\n\t\tif (document.getElementById(WIDGET_ID)) {\r\n\t\t\tconsole.warn('Dental Chatbot Widget is already initialized');\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// Get current script element and domain\r\n\t\tconst scriptElement = getCurrentScriptElement();\r\n\t\tconst currentDomain = window.location.hostname || 'unknown';\r\n\r\n\t\t// Create widget iframe\r\n\t\tconst iframe = document.createElement('iframe');\r\n\r\n\t\t// Set iframe attributes\r\n\t\tiframe.id = WIDGET_ID;\r\n\t\tiframe.title = 'Dental Support Chat';\r\n\t\tiframe.setAttribute('aria-label', 'Dental Support Chat Widget');\r\n\r\n\t\t// Set iframe styles\r\n\t\tObject.assign(iframe.style, {\r\n\t\t\tposition: 'fixed',\r\n\t\t\tbottom: '16px',\r\n\t\t\tright: '16px',\r\n\t\t\twidth: DEFAULT_WIDTH,\r\n\t\t\theight: DEFAULT_HEIGHT,\r\n\t\t\tborder: 'none',\r\n\t\t\tzIndex: '2147483647', // Max z-index value\r\n\t\t\toverflow: 'hidden',\r\n\t\t\ttransition: 'all 0.3s ease',\r\n\t\t\tboxShadow: '0 0 10px rgba(0, 0, 0, 0.1)',\r\n\t\t\tborderRadius: '8px 8px 0 0'\r\n\t\t});\r\n\r\n\t\t// Set the src with domain parameter\r\n\t\tconst widgetUrl = new URL('/widget', scriptElement?.src || window.location.href);\r\n\r\n\t\t// Add domain and other parameters\r\n\t\twidgetUrl.searchParams.set('domain', currentDomain);\r\n\t\twidgetUrl.searchParams.set('t', Date.now().toString()); // Cache busting\r\n\t\tiframe.src = widgetUrl.toString();\r\n\r\n\t\t// Add to body\r\n\t\tdocument.body.appendChild(iframe);\r\n\r\n\t\treturn iframe;\r\n\t} catch (error) {\r\n\t\tconsole.error('Failed to initialize Dental Chatbot Widget:', error);\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\n/**\r\n * Get the current script element\r\n */\r\nfunction getCurrentScriptElement(): HTMLScriptElement | null {\r\n\t// Get the current script\r\n\tif (document.currentScript) {\r\n\t\treturn document.currentScript as HTMLScriptElement;\r\n\t}\r\n\r\n\t// Fallback for browsers that don't support currentScript\r\n\tconst scripts = document.getElementsByTagName('script');\r\n\treturn scripts[scripts.length - 1];\r\n}\r\n\r\n/**\r\n * Create and expose the widget API\r\n */\r\nfunction createWidgetAPI(iframe: HTMLIFrameElement | null): ChatbotWidgetAPI {\r\n\tconst api: ChatbotWidgetAPI = {\r\n\t\topen: () => {\r\n\t\t\tif (!iframe) return;\r\n\t\t\tiframe.style.height = DEFAULT_HEIGHT;\r\n\t\t\tiframe.contentWindow?.postMessage('chatbot-open', '*');\r\n\t\t},\r\n\r\n\t\tclose: () => {\r\n\t\t\tif (!iframe) return;\r\n\t\t\tiframe.style.height = MINIMIZED_HEIGHT;\r\n\t\t\tiframe.contentWindow?.postMessage('chatbot-close', '*');\r\n\t\t},\r\n\r\n\t\ttoggle: () => {\r\n\t\t\tif (!iframe) return;\r\n\t\t\tif (api.isOpen()) {\r\n\t\t\t\tapi.close();\r\n\t\t\t} else {\r\n\t\t\t\tapi.open();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tisOpen: () => {\r\n\t\t\tif (!iframe) return false;\r\n\t\t\treturn iframe.style.height !== MINIMIZED_HEIGHT;\r\n\t\t}\r\n\t};\r\n\r\n\treturn api;\r\n}\r\n\r\n// Initialize the widget and create API\r\ntry {\r\n\t// Create the iframe\r\n\tconst iframe = initializeChatbotWidget();\r\n\r\n\t// Create and expose the API\r\n\tconst widgetAPI = createWidgetAPI(iframe);\r\n\r\n\t// Add the API to the global scope\r\n\twindow.ChatbotWidget = widgetAPI;\r\n\r\n\t// Listen for messages from the iframe\r\n\twindow.addEventListener('message', (event) => {\r\n\t\t// In production, you should verify the origin\r\n\t\tif (event.data === 'chatbot-widget-loaded') {\r\n\t\t\tconsole.log('Dental Chatbot Widget loaded successfully');\r\n\t\t}\r\n\t});\r\n} catch (error) {\r\n\tconsole.error('Error initializing Dental Chatbot Widget:', error);\r\n}\r\n\r\n// Export nothing for TypeScript compatibility\r\nexport {};\r\n"],"names":["WIDGET_ID","DEFAULT_WIDTH","DEFAULT_HEIGHT","MINIMIZED_HEIGHT","initializeChatbotWidget","scriptElement","getCurrentScriptElement","currentDomain","iframe","widgetUrl","error","scripts","createWidgetAPI","api","_a","widgetAPI","event"],"mappings":"yBAeA,MAAMA,EAAY,+BACZC,EAAgB,QAChBC,EAAiB,QACjBC,EAAmB,OAczB,SAASC,GAAoD,CACxD,GAAA,CAEC,GAAA,SAAS,eAAeJ,CAAS,EACpC,eAAQ,KAAK,8CAA8C,EACpD,KAIR,MAAMK,EAAgBC,EAAwB,EACxCC,EAAgB,OAAO,SAAS,UAAY,UAG5CC,EAAS,SAAS,cAAc,QAAQ,EAG9CA,EAAO,GAAKR,EACZQ,EAAO,MAAQ,sBACRA,EAAA,aAAa,aAAc,4BAA4B,EAGvD,OAAA,OAAOA,EAAO,MAAO,CAC3B,SAAU,QACV,OAAQ,OACR,MAAO,OACP,MAAOP,EACP,OAAQC,EACR,OAAQ,OACR,OAAQ,aACR,SAAU,SACV,WAAY,gBACZ,UAAW,8BACX,aAAc,aAAA,CACd,EAGK,MAAAO,EAAY,IAAI,IAAI,WAAWJ,GAAA,YAAAA,EAAe,MAAO,OAAO,SAAS,IAAI,EAGrE,OAAAI,EAAA,aAAa,IAAI,SAAUF,CAAa,EAClDE,EAAU,aAAa,IAAI,IAAK,KAAK,IAAI,EAAE,UAAU,EAC9CD,EAAA,IAAMC,EAAU,SAAS,EAGvB,SAAA,KAAK,YAAYD,CAAM,EAEzBA,QACCE,EAAO,CACP,eAAA,MAAM,8CAA+CA,CAAK,EAC3D,IAAA,CAET,CAKA,SAASJ,GAAoD,CAE5D,GAAI,SAAS,cACZ,OAAO,SAAS,cAIX,MAAAK,EAAU,SAAS,qBAAqB,QAAQ,EAC/C,OAAAA,EAAQA,EAAQ,OAAS,CAAC,CAClC,CAKA,SAASC,EAAgBJ,EAAoD,CAC5E,MAAMK,EAAwB,CAC7B,KAAM,IAAM,OACNL,IACLA,EAAO,MAAM,OAASN,GACfY,EAAAN,EAAA,gBAAA,MAAAM,EAAe,YAAY,eAAgB,KACnD,EAEA,MAAO,IAAM,OACPN,IACLA,EAAO,MAAM,OAASL,GACfW,EAAAN,EAAA,gBAAA,MAAAM,EAAe,YAAY,gBAAiB,KACpD,EAEA,OAAQ,IAAM,CACRN,IACDK,EAAI,SACPA,EAAI,MAAM,EAEVA,EAAI,KAAK,EAEX,EAEA,OAAQ,IACFL,EACEA,EAAO,MAAM,SAAWL,EADX,EAGtB,EAEO,OAAAU,CACR,CAGA,GAAI,CAEH,MAAML,EAASJ,EAAwB,EAGjCW,EAAYH,EAAgBJ,CAAM,EAGxC,OAAO,cAAgBO,EAGhB,OAAA,iBAAiB,UAAYC,GAAU,CAEzCA,EAAM,OAAS,yBAClB,QAAQ,IAAI,2CAA2C,CACxD,CACA,CACF,OAASN,EAAO,CACP,QAAA,MAAM,4CAA6CA,CAAK,CACjE"}